<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>2018/12/21にPyData Osakaの梅キャンPython勉強会コラボ回でpybind11について発表しました | hiromasa.info</title>
<link href="../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=Playfair+Display:700,900" rel="stylesheet">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS (en)" hreflang="en" href="../../rss.xml">
<link rel="alternate" type="application/rss+xml" title="RSS (ja)" hreflang="ja" href="../../../rss.xml">
<link rel="canonical" href="http://www.hiromasa.info/en/posts/14/">
<!--[if lt IE 9]><script src="../../../assets/js/html5.js"></script><![endif]--><meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' data: http://*.google-analytics.com https://*.hiromasa.info https://*.google-analytics.com https://code.jquery.com http://*.disqus.com https://disqus.com https://*.disqus.com https://*.disquscdn.com https://*.cloudinary.com http://www.gravatar.com https://www.googletagmanager.com https://*.twitter.com http://*.facebook.com https://*.facebook.com https://*.facebook.net http://*.hatena.ne.jp https://*.st-hatena.com https://cdnjs.cloudflare.com https://fonts.gstatic.com;">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-48887105-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-48887105-1');
</script><!-- End Google Analytics --><!-- for facebook button --><style>
.fb-like {
    display: inline;
}
#fb-root {
    display: inline;
}
.fb_iframe_widget > span {
    vertical-align: baseline !important; 
}
</style>
<meta name="author" content="Hiromasa OHASHI">
<link rel="prev" href="../13/" title="Pyroomacousticsの紹介" type="text/html">
<link rel="next" href="../15/" title="2019/3/24にmatplotlibのアニメーション機能に関する発表を行いました" type="text/html">
<meta property="og:site_name" content="hiromasa.info">
<meta property="og:title" content="2018/12/21にPyData Osakaの梅キャンPython勉強会コラボ回でpybind11について発表しました">
<meta property="og:url" content="http://www.hiromasa.info/en/posts/14/">
<meta property="og:description" content="2018/12/21(金)にPyData Osakaの梅キャンPython勉強会コラボ回でpybind11について発表しました¶ブログ記事にするのが遅くなりましたが2018/12/21に【大阪工業大学】特別回 梅キャンPython勉強会【梅田キャンパス】 でpybind11に関する発表を行いました。
下記はその際の資料になります。






In [1]:

    
from IPython.">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2019-02-10T15:30:00+09:00">
<meta property="article:tag" content="numpy">
<meta property="article:tag" content="pybind11">
<meta property="article:tag" content="pydata">
<meta property="article:tag" content="python">
<link rel="alternate" hreflang="ja" href="../../../posts/14/">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.css" integrity="sha384-yFRtMMDnQtDRO8rLpMIKrtPCD5jdktao2TV19YiZYWMDkUR5GQZR/NOVTdquEx1j" crossorigin="anonymous">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Header and menu bar -->
<div class="container">
      <header class="blog-header py-3"><div class="row nbb-header align-items-center">
          <div class="col-md-3 col-xs-2 col-sm-2" style="width: auto;">
            <button class="navbar-toggler navbar-light bg-light nbb-navbar-toggler" type="button" data-toggle="collapse" data-target=".bs-nav-collapsible" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse bs-nav-collapsible bootblog4-search-form-holder">
                
            </div>
        </div>
          <div class="col-md-6 col-xs-10 col-sm-10 bootblog4-brand" style="width: auto;">
            <a class="navbar-brand blog-header-logo text-dark" href="../../">

            <span id="blog-title">hiromasa.info</span>
        </a>
          </div>
            <div class="col-md-3 justify-content-end align-items-center bs-nav-collapsible collapse flex-collapse bootblog4-right-nav">
            <nav class="navbar navbar-light bg-white"><ul class="navbar-nav bootblog4-right-nav">
<li class="nav-item"><a href="../../../" rel="alternate" hreflang="ja" class="nav-link">日本語</a></li>

                    
                    
    
    <li class="nav-item">
    <a href="index.ipynb" id="sourcelink" class="nav-link">Source</a>
    </li>


                    
            </ul></nav>
</div>
    </div>
</header><nav class="navbar navbar-expand-md navbar-light bg-white static-top"><div class="collapse navbar-collapse bs-nav-collapsible" id="bs-navbar">
            <ul class="navbar-nav nav-fill d-flex w-100">
<li class="nav-item">
<a href="../../archive.html" class="nav-link">all posts</a>
                </li>
<li class="nav-item">
<a href="../../categories/" class="nav-link">tag</a>
                </li>
<li class="nav-item">
<a href="../../pages/about/index.html" class="nav-link">about</a>
                </li>
<li class="nav-item">
<a href="../../pages/slides/index.html" class="nav-link">slides</a>
                </li>
<li class="nav-item">
<a href="../../rss.xml" class="nav-link">RSS feed</a>

                
            </li>
</ul>
</div>
<!-- /.navbar-collapse -->
</nav>
</div>

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
        
        
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">2018/12/21にPyData Osakaの梅キャンPython勉強会コラボ回でpybind11について発表しました</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    Hiromasa OHASHI
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2019-02-10T15:30:00+09:00" itemprop="datePublished" title="2019-02-10 15:30">2019-02-10 15:30</time></a>
            </p>
                <p class="commentline">
        
    <a href="#disqus_thread" data-disqus-identifier="cache/posts/14.html">Comments</a>


            
        </p>
<p class="sourceline"><a href="index.ipynb" class="sourcelink">Source</a></p>

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="2018/12/21(金)にPyData-Osakaの梅キャンPython勉強会コラボ回でpybind11について発表しました">2018/12/21(金)にPyData Osakaの梅キャンPython勉強会コラボ回でpybind11について発表しました<a class="anchor-link" href="#2018/12/21(%E9%87%91)%E3%81%ABPyData-Osaka%E3%81%AE%E6%A2%85%E3%82%AD%E3%83%A3%E3%83%B3Python%E5%8B%89%E5%BC%B7%E4%BC%9A%E3%82%B3%E3%83%A9%E3%83%9C%E5%9B%9E%E3%81%A7pybind11%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E7%99%BA%E8%A1%A8%E3%81%97%E3%81%BE%E3%81%97%E3%81%9F">¶</a>
</h3>
<p>ブログ記事にするのが遅くなりましたが2018/12/21に<a href="https://studygroup-umecanoit.connpass.com/event/110422/">【大阪工業大学】特別回 梅キャンPython勉強会【梅田キャンパス】 </a>でpybind11に関する発表を行いました。
下記はその際の資料になります。</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [1]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">IFrame</span>
<span class="n">IFrame</span><span class="p">(</span><span class="s2">"https://www.hiromasa.info/slide/14.slides.html"</span><span class="p">,</span> <span class="s2">"100%"</span><span class="p">,</span> <span class="s2">"450px"</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[1]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">

        <iframe width="100%" height="450px" src="https://www.hiromasa.info/slide/14.slides.html" frameborder="0" allowfullscreen></iframe>
        
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="pybind11の紹介">pybind11の紹介<a class="anchor-link" href="#pybind11%E3%81%AE%E7%B4%B9%E4%BB%8B">¶</a>
</h3>
<p>大橋宏正(PyDataオーガナイザー)</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="自己紹介">自己紹介<a class="anchor-link" href="#%E8%87%AA%E5%B7%B1%E7%B4%B9%E4%BB%8B">¶</a>
</h4>
<ul>
<li>大橋 宏正(@wrist)</li>
<li>PyDataオーガナイザー</li>
<li>某メーカー勤務<ul>
<li>音響信号処理屋</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="pybind11とは">pybind11とは<a class="anchor-link" href="#pybind11%E3%81%A8%E3%81%AF">¶</a>
</h4>
<ul>
<li>C拡張モジュールをc++11で作成するためのライブラリ</li>
<li>ヘッダオンリー</li>
<li>numpy, Eigen連携</li>
<li><a href="https://ep2017.europython.eu/media/conference/slides/pybind11-seamless-operability-between-c11-and-python.pdf">https://ep2017.europython.eu/media/conference/slides/pybind11-seamless-operability-between-c11-and-python.pdf</a></li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="他のライブラリとの比較">他のライブラリとの比較<a class="anchor-link" href="#%E4%BB%96%E3%81%AE%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%81%A8%E3%81%AE%E6%AF%94%E8%BC%83">¶</a>
</h4>
<ul>
<li>Python C API<ul>
<li>自分で参照カウント制御が必要</li>
<li>学習障壁が高い</li>
</ul>
</li>
<li>ctypes<ul>
<li>dllがあればビルド不要で使える</li>
<li>返り値や引数の型を厳密に設定する必要有</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>cython<ul>
<li>pyxの独自記法を覚える必要</li>
<li>一旦pyxファイルをcにコンパイル<ul>
<li>更にcファイルをコンパイル</li>
</ul>
</li>
</ul>
</li>
<li>Boost.python<ul>
<li>Boostが必要</li>
<li>便利だが巨大でありコンパイルに時間がかかる</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="インストール">インストール<a class="anchor-link" href="#%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB">¶</a>
</h4>
<ul>
<li><a href="https://github.com/pybind/pybind11">https://github.com/pybind/pybind11</a></li>
<li>pipでインストール可能</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [1]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>pip install pybind11
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Requirement already satisfied: pybind11 in /Users/wrist/.pyenv/versions/miniconda3-4.3.30/envs/py36/lib/python3.6/site-packages (2.2.4)
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="ipybind">ipybind<a class="anchor-link" href="#ipybind">¶</a>
</h4>
<ul>
<li>pybind11のjupyter拡張</li>
<li>jupyter notebookのセルから実行可能</li>
<li><a href="https://github.com/aldanor/ipybind">https://github.com/aldanor/ipybind</a></li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="ipybindのインストール">ipybindのインストール<a class="anchor-link" href="#ipybind%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB">¶</a>
</h4>
<ul>
<li>リポジトリをクローン</li>
<li><code>python setup.py build</code></li>
<li><code>python setup.py install</code></li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="使ってみる">使ってみる<a class="anchor-link" href="#%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8B">¶</a>
</h4>
<ul>
<li>ipybind経由でpybind11を使用</li>
<li>最初に<code>load_ext</code>でipybindを有効化</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> ipybind
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>





<div id="ee6ae531-3b23-4e2a-adf6-84e82cc3ed63"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#ee6ae531-3b23-4e2a-adf6-84e82cc3ed63');

    require(['notebook/js/codecell'], function(cc) {
        cc.CodeCell.options_default.highlight_modes['magic_text/x-c++src'] =
            {reg: [/^\s*%%pybind11/]};
    });
    
</script>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">

    <style>
    .cm-s-ipython span.cm-variable-3 {
        color: #208ffb;
        font-weight: bold;
    }
    </style>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="pybind11の基本">pybind11の基本<a class="anchor-link" href="#pybind11%E3%81%AE%E5%9F%BA%E6%9C%AC">¶</a>
</h4>
<ul>
<li><code>PYBIND_MODULE(モジュール名, m)</code></li>
<li><code>m.def(公開名, 関数へのポインタ, 説明)</code></li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">pybind11</span>

int add(int x, int y){
    return x + y;
}

PYBIND11_MODULE(myadd, m){
    m.def("c_add", &amp;add, "Add two integers.");
}
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [4]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">c_add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[4]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>3</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [5]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">help</span><span class="p">(</span><span class="n">c_add</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Help on built-in function c_add in module pybind11_3e2e466:

c_add(...) method of builtins.PyCapsule instance
    c_add(arg0: int, arg1: int) -&gt; int
    
    Add two integers.

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [6]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># c_add("foo", "bar")</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [7]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">pybind11</span>

PYBIND11_MODULE(myadd, m){
    m.def("lambda_add", [](int a, int b){ return a + b;},
         "Add two integers.");
}
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [8]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">lambda_add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[8]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>3</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="その他のコンパイル方法">その他のコンパイル方法<a class="anchor-link" href="#%E3%81%9D%E3%81%AE%E4%BB%96%E3%81%AE%E3%82%B3%E3%83%B3%E3%83%91%E3%82%A4%E3%83%AB%E6%96%B9%E6%B3%95">¶</a>
</h4>
<ul>
<li>手動ビルド</li>
<li>distutils<ul>
<li>setup.pyを書く</li>
</ul>
</li>
<li>cmake<ul>
<li><code>pybind11_add_module(myadd myadd.cpp)</code></li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="単純なクラスをラップ">単純なクラスをラップ<a class="anchor-link" href="#%E5%8D%98%E7%B4%94%E3%81%AA%E3%82%AF%E3%83%A9%E3%82%B9%E3%82%92%E3%83%A9%E3%83%83%E3%83%97">¶</a>
</h4>
<ul>
<li>c++のクラスを定義</li>
<li>pybind11でラップ<ul>
<li><code>py::classs_&lt;C++クラス名&gt;(m, 公開クラス名)</code></li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [9]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">pybind11</span>

namespace py = pybind11;

class Coordinate {
public:
    int x_;
    int y_;
    Coordinate(){ x_ = 0; y_ = 0; }
    Coordinate(int x, int y){ x_ = x; y_ = y; }
    float Norm(){ return sqrt(x_*x_ + y_*y_); }
};

PYBIND11_MODULE(coord, m) {
    py::class_&lt;Coordinate&gt;(m, "Coordinate")
        .def(py::init&lt;&gt;())
        .def(py::init&lt;int, int&gt;())
        .def_readonly("x", &amp;Coordinate::x_)
        .def_readonly("y", &amp;Coordinate::y_)
        .def_property_readonly("norm", &amp;Coordinate::Norm);
}
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="コンストラクタの定義">コンストラクタの定義<a class="anchor-link" href="#%E3%82%B3%E3%83%B3%E3%82%B9%E3%83%88%E3%83%A9%E3%82%AF%E3%82%BF%E3%81%AE%E5%AE%9A%E7%BE%A9">¶</a>
</h4>
<ul>
<li><code>... .def(py::init&lt;オーバーロード引数&gt;())</code></li>
</ul>
<div class="highlight"><pre><span></span><span class="n">Coordinate</span><span class="p">(){</span> <span class="n">x_</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">y_</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">}</span>
    <span class="n">Coordinate</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">){</span> <span class="n">x_</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span> <span class="n">y_</span> <span class="o">=</span> <span class="n">y</span><span class="p">;</span> <span class="p">}</span>
</pre></div>
<p>は下記のように記載</p>
<div class="highlight"><pre><span></span><span class="n">py</span><span class="o">::</span><span class="n">class_</span><span class="o">&lt;</span><span class="n">Coordinate</span><span class="o">&gt;</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s">"Coordinate"</span><span class="p">)</span>
        <span class="p">.</span><span class="n">def</span><span class="p">(</span><span class="n">py</span><span class="o">::</span><span class="n">init</span><span class="o">&lt;&gt;</span><span class="p">())</span>
        <span class="p">.</span><span class="n">def</span><span class="p">(</span><span class="n">py</span><span class="o">::</span><span class="n">init</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span><span class="p">())</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="プロパティの定義">プロパティの定義<a class="anchor-link" href="#%E3%83%97%E3%83%AD%E3%83%91%E3%83%86%E3%82%A3%E3%81%AE%E5%AE%9A%E7%BE%A9">¶</a>
</h4>
<ul>
<li><code>... .def_readonly(公開変数名, メンバへのポインタ)</code></li>
</ul>
<div class="highlight"><pre><span></span><span class="n">py</span><span class="o">::</span><span class="n">class_</span><span class="o">&lt;</span><span class="n">Coordinate</span><span class="o">&gt;</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s">"Coordinate"</span><span class="p">)</span>
        <span class="p">.</span><span class="n">def_readonly</span><span class="p">(</span><span class="s">"x"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">Coordinate</span><span class="o">::</span><span class="n">x_</span><span class="p">)</span>
        <span class="p">.</span><span class="n">def_readonly</span><span class="p">(</span><span class="s">"y"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">Coordinate</span><span class="o">::</span><span class="n">y_</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="computed-propetyの定義">computed propetyの定義<a class="anchor-link" href="#computed-propety%E3%81%AE%E5%AE%9A%E7%BE%A9">¶</a>
</h4>
<ul>
<li><code>... .def_propety_readonly(公開変数名, 計算関数へのポインタ)</code></li>
</ul>
<div class="highlight"><pre><span></span><span class="kt">float</span> <span class="nf">Norm</span><span class="p">(){</span> <span class="k">return</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">x_</span><span class="o">*</span><span class="n">x_</span> <span class="o">+</span> <span class="n">y_</span><span class="o">*</span><span class="n">y_</span><span class="p">);</span> <span class="p">}</span>
</pre></div>
<p>は</p>
<div class="highlight"><pre><span></span><span class="p">.</span><span class="n">def_property_readonly</span><span class="p">(</span><span class="s">"norm"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">Coordinate</span><span class="o">::</span><span class="n">Norm</span><span class="p">);</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [10]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">point</span> <span class="o">=</span> <span class="n">Coordinate</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">point</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[10]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>&lt;pybind11_c19ca2a.Coordinate at 0x10ba96df8&gt;</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [11]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">point</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">point</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>3 4
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [12]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">point</span><span class="o">.</span><span class="n">norm</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[12]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>5.0</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="さらなる例">さらなる例<a class="anchor-link" href="#%E3%81%95%E3%82%89%E3%81%AA%E3%82%8B%E4%BE%8B">¶</a>
</h4>
<ul>
<li>演算子オーバーロード、python特殊メソッド</li>
<li>docstring、引数名、キーワード引数</li>
<li><code>*arg, **kwarg</code></li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="演算子オーバーロード">演算子オーバーロード<a class="anchor-link" href="#%E6%BC%94%E7%AE%97%E5%AD%90%E3%82%AA%E3%83%BC%E3%83%90%E3%83%BC%E3%83%AD%E3%83%BC%E3%83%89">¶</a>
</h4>
<ul>
<li>等値演算子<ul>
<li>cppだと<code>bool operator==(const Cls&amp; rhs)</code>
</li>
<li>pythonだと<code>Cls.__eq__(self, other)</code>
</li>
<li>これらを対応付ける</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [13]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">int</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[13]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>True</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [14]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">pybind11</span>

namespace py = pybind11;

class Coordinate2 {
public:
    int x_; int y_;
    Coordinate2(){ x_ = 0; y_ = 0; }
    Coordinate2(int x, int y){ x_ = x; y_ = y; }
    bool operator==(const Coordinate2&amp; rhs){
        return (x_ == rhs.x_) &amp;&amp; (y_ == rhs.y_);
    }
};

PYBIND11_MODULE(coord2, m) {
    py::class_&lt;Coordinate2&gt;(m, "Coordinate2")
        .def(py::init&lt;&gt;())
        .def(py::init&lt;int, int&gt;())
        .def_readonly("x", &amp;Coordinate2::x_)
        .def_readonly("y", &amp;Coordinate2::y_)
        .def("__eq__", &amp;Coordinate2::operator==);
}
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [15]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">point1</span> <span class="o">=</span> <span class="n">Coordinate2</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">point2</span> <span class="o">=</span> <span class="n">Coordinate2</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">point3</span> <span class="o">=</span> <span class="n">Coordinate2</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [16]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">point1</span> <span class="o">==</span> <span class="n">point2</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[16]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>True</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [17]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">point1</span> <span class="o">==</span> <span class="n">point3</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[17]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>False</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="演算子の代替記法">演算子の代替記法<a class="anchor-link" href="#%E6%BC%94%E7%AE%97%E5%AD%90%E3%81%AE%E4%BB%A3%E6%9B%BF%E8%A8%98%E6%B3%95">¶</a>
</h4>
<div class="highlight"><pre><span></span><span class="p">.</span><span class="n">def</span><span class="p">(</span><span class="s">"__eq__"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">Coordinate2</span><span class="o">::</span><span class="k">operator</span><span class="o">==</span><span class="p">);</span>
</pre></div>
<p>はc++のクラスで<code>operator==</code>が定義されていれば下記のようにも書ける</p>
<div class="highlight"><pre><span></span><span class="p">.</span><span class="n">def</span><span class="p">(</span><span class="s">"__eq__"</span><span class="p">,</span> 
             <span class="p">[](</span><span class="k">const</span> <span class="n">Coordinate2</span><span class="o">&amp;</span> <span class="n">self</span><span class="p">,</span>
                <span class="k">const</span> <span class="n">Coordinate2</span><span class="o">&amp;</span> <span class="n">other</span><span class="p">){</span>
                 <span class="k">return</span> <span class="n">self</span> <span class="o">==</span> <span class="n">other</span><span class="p">;</span> 
             <span class="p">});</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Python特殊メソッド">Python特殊メソッド<a class="anchor-link" href="#Python%E7%89%B9%E6%AE%8A%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89">¶</a>
</h4>
<ul>
<li>
<code>__repr__</code>の定義を考える</li>
<li>先の<code>__eq__</code>と同様に第一引数にselfを取るメソッドを定義</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [18]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">pybind11</span>

namespace py = pybind11;

class Coordinate3 {
public:
    int x_; int y_;
    Coordinate3(){ x_ = 0; y_ = 0; }
    Coordinate3(int x, int y){ x_ = x; y_ = y; }
};

PYBIND11_MODULE(coord3, m) {
    py::class_&lt;Coordinate3&gt;(m, "Coordinate3")
        .def(py::init&lt;&gt;())
        .def(py::init&lt;int, int&gt;())
        .def_readonly("x", &amp;Coordinate3::x_)
        .def_readonly("y", &amp;Coordinate3::y_)
        .def("__repr__" , [](const Coordinate3&amp; self){
            return std::string() + "(x, y) = (" + std::to_string(self.x_) + ", " + std::to_string(self.y_) + ")";
        });
} 
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="highlight"><pre><span></span><span class="p">.</span><span class="n">def</span><span class="p">(</span><span class="s">"__repr__"</span><span class="p">,</span> <span class="p">[](</span><span class="k">const</span> <span class="n">Coordinate3</span><span class="o">&amp;</span> <span class="n">self</span><span class="p">){</span>
    <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">()</span> <span class="o">+</span> 
        <span class="s">"(x, y) = ("</span> <span class="o">+</span>
        <span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">x_</span><span class="p">)</span> <span class="o">+</span>
        <span class="s">", "</span> <span class="o">+</span>
        <span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">y_</span><span class="p">)</span> <span class="o">+</span> <span class="s">")"</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [19]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">point</span> <span class="o">=</span> <span class="n">Coordinate3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">point</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[19]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>(x, y) = (1, 2)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="docstirng、引数名、キーワード引数">docstirng、引数名、キーワード引数<a class="anchor-link" href="#docstirng%E3%80%81%E5%BC%95%E6%95%B0%E5%90%8D%E3%80%81%E3%82%AD%E3%83%BC%E3%83%AF%E3%83%BC%E3%83%89%E5%BC%95%E6%95%B0">¶</a>
</h4>
<ul>
<li>docstring<ul>
<li>
<code>m.def</code>の第三引数に文字列を渡す</li>
</ul>
</li>
<li>引数名<ul>
<li>第四引数以降に<code>py::arg("...")</code>を渡す</li>
</ul>
</li>
<li>キーワード引数<ul>
<li>
<code>py::arg("...") = デフォルト値</code>とすれば良い</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [20]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">pybind11</span>

namespace py = pybind11;

class Coordinate4 {
public:
    int x_; int y_;
    Coordinate4(){ x_ = 0; y_ = 0; }
    Coordinate4(int x, int y){ x_ = x; y_ = y; }
    float DistanceTo(const Coordinate4&amp; target){ 
        int dx = target.x_ - x_, dy = target.y_ - y_;
        return sqrt( dx*dx + dy*dy);
    }
};

PYBIND11_MODULE(coord4, m) {
    py::class_&lt;Coordinate4&gt;(m, "Coordinate4")
        .def(py::init&lt;&gt;())
        .def(py::init&lt;int, int&gt;())
        .def_readonly("x", &amp;Coordinate4::x_)
        .def_readonly("y", &amp;Coordinate4::y_)
        .def("distance_to", &amp;Coordinate4::DistanceTo,
             "distance to target",
             py::arg("target"));
}
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="highlight"><pre><span></span><span class="kt">float</span> <span class="nf">DistanceTo</span><span class="p">(</span><span class="k">const</span> <span class="n">Coordinate4</span><span class="o">&amp;</span> <span class="n">target</span><span class="p">){</span> 
        <span class="kt">int</span> <span class="n">dx</span> <span class="o">=</span> <span class="n">target</span><span class="p">.</span><span class="n">x_</span> <span class="o">-</span> <span class="n">x_</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="n">target</span><span class="p">.</span><span class="n">y_</span> <span class="o">-</span> <span class="n">y_</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">sqrt</span><span class="p">(</span> <span class="n">dx</span><span class="o">*</span><span class="n">dx</span> <span class="o">+</span> <span class="n">dy</span><span class="o">*</span><span class="n">dy</span><span class="p">);</span>
    <span class="p">}</span>
</pre></div>
<p>を下記のように設定</p>
<div class="highlight"><pre><span></span><span class="p">.</span><span class="n">def</span><span class="p">(</span><span class="s">"distance_to"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">Coordinate4</span><span class="o">::</span><span class="n">DistanceTo</span><span class="p">,</span>
             <span class="s">"distance to target"</span><span class="p">,</span>
             <span class="n">py</span><span class="o">::</span><span class="n">arg</span><span class="p">(</span><span class="s">"target"</span><span class="p">));</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [24]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">point</span> <span class="o">=</span> <span class="n">Coordinate4</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">target</span> <span class="o">=</span> <span class="n">Coordinate4</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">point</span><span class="o">.</span><span class="n">distance_to</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[24]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>2.8284270763397217</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [40]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span>point.distance_to<span class="o">?</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="*args,-**kwarg">
<code>*args, **kwarg</code><a class="anchor-link" href="#*args,-**kwarg">¶</a>
</h4>
<ul>
<li>
<code>py::args</code> (<code>py::tuple</code>のサブクラス)</li>
<li>
<code>py::kwargs</code> (<code>py::dict</code>のサブクラス)</li>
</ul>
<div class="highlight"><pre><span></span><span class="n">m</span><span class="p">.</span><span class="n">def</span><span class="p">(</span><span class="s">"count_args"</span><span class="p">,</span> <span class="p">[](</span><span class="n">py</span><span class="o">::</span><span class="n">args</span> <span class="n">a</span><span class="p">,</span> <span class="n">py</span><span class="o">::</span><span class="n">kwargs</span> <span class="n">kw</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">py</span><span class="o">::</span><span class="n">print</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="s">"args,"</span><span class="p">,</span> <span class="n">kw</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="s">"kwargs"</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="その他の話題">その他の話題<a class="anchor-link" href="#%E3%81%9D%E3%81%AE%E4%BB%96%E3%81%AE%E8%A9%B1%E9%A1%8C">¶</a>
</h4>
<ul>
<li>C++とPython間のオブジェクトの取扱</li>
<li>関数とコールバック</li>
<li>Numpy対応</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="C++とPython間のオブジェクトの取扱">C++とPython間のオブジェクトの取扱<a class="anchor-link" href="#C++%E3%81%A8Python%E9%96%93%E3%81%AE%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E5%8F%96%E6%89%B1">¶</a>
</h4>
<ul>
<li>C++とPythonのオブジェクトを混在してラッパーを定義可能</li>
<li>3種類の方法<ul>
<li>Python側でC++の型のインスタンスを引数に取る</li>
<li>C++側でPythonの型のインスタンスを引数に取る</li>
<li>C++の型とPythonの型を型変換する</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Python側でC++の型のインスタンスを引数に取る">Python側でC++の型のインスタンスを引数に取る<a class="anchor-link" href="#Python%E5%81%B4%E3%81%A7C++%E3%81%AE%E5%9E%8B%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%82%BF%E3%83%B3%E3%82%B9%E3%82%92%E5%BC%95%E6%95%B0%E3%81%AB%E5%8F%96%E3%82%8B">¶</a>
</h4>
<div class="highlight"><pre><span></span><span class="n">py</span><span class="o">::</span><span class="n">class_</span><span class="o">&lt;</span><span class="n">Foo</span><span class="o">&gt;</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s">"Foo"</span><span class="p">);</span>
<span class="n">m</span><span class="p">.</span><span class="n">def</span><span class="p">(</span><span class="s">"f1"</span><span class="p">,</span> <span class="p">[](</span><span class="k">const</span> <span class="n">Foo</span><span class="o">&amp;</span> <span class="n">foo</span><span class="p">){</span> <span class="p">...}</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="C++側でPythonの型のインスタンスを引数に取る">C++側でPythonの型のインスタンスを引数に取る<a class="anchor-link" href="#C++%E5%81%B4%E3%81%A7Python%E3%81%AE%E5%9E%8B%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%82%BF%E3%83%B3%E3%82%B9%E3%82%92%E5%BC%95%E6%95%B0%E3%81%AB%E5%8F%96%E3%82%8B">¶</a>
</h4>
<div class="highlight"><pre><span></span><span class="n">m</span><span class="p">.</span><span class="n">def</span><span class="p">(</span><span class="s">"f2"</span><span class="p">,</span> <span class="p">[](</span><span class="n">py</span><span class="o">::</span><span class="n">list</span> <span class="n">list</span><span class="p">){</span> <span class="p">...</span> <span class="p">}</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="C++の型とPythonの型を型変換する">C++の型とPythonの型を型変換する<a class="anchor-link" href="#C++%E3%81%AE%E5%9E%8B%E3%81%A8Python%E3%81%AE%E5%9E%8B%E3%82%92%E5%9E%8B%E5%A4%89%E6%8F%9B%E3%81%99%E3%82%8B">¶</a>
</h4>
<div class="highlight"><pre><span></span><span class="n">m</span><span class="p">.</span><span class="n">def</span><span class="p">(</span><span class="s">"f3"</span><span class="p">,</span> <span class="p">[](</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">});</span>
<span class="n">m</span><span class="p">.</span><span class="n">def</span><span class="p">(</span><span class="s">"f4"</span><span class="p">,</span> <span class="p">[](</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">s</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">});</span>
<span class="n">m</span><span class="p">.</span><span class="n">def</span><span class="p">(</span><span class="s">"f5"</span><span class="p">,</span> <span class="p">[](</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&amp;</span> <span class="n">v</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">});</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="サポートされている型変換">サポートされている型変換<a class="anchor-link" href="#%E3%82%B5%E3%83%9D%E3%83%BC%E3%83%88%E3%81%95%E3%82%8C%E3%81%A6%E3%81%84%E3%82%8B%E5%9E%8B%E5%A4%89%E6%8F%9B">¶</a>
</h4>
<ul>
<li>スカラー値<ul>
<li>integer types, float, double, bool, char</li>
</ul>
</li>
<li>文字列<ul>
<li>std::string, const char *</li>
</ul>
</li>
<li>タプル<ul>
<li>std::pair&lt;F, S&gt;, std::tuple&lt;...&gt;</li>
</ul>
</li>
<li>シーケンス<ul>
<li>std::vector<t>, std::list<t>, std::array&lt;T, n&gt;</t></t>
</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>マップ<ul>
<li>std::map&lt;K, V&gt;, std::unordered_map&lt;K, V&gt;</li>
</ul>
</li>
<li>集合<ul>
<li>std::set<t>, std::unordered_set<t></t></t>
</li>
</ul>
</li>
<li>関数<ul>
<li>std::function&lt;...&gt;</li>
</ul>
</li>
<li>Date/time<ul>
<li>std::chrono::duration, std::chrono::time_point</li>
</ul>
</li>
<li>Optional<ul>
<li>std::optional<t>, std::experimental::optional<t></t></t>
</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="関数とコールバック">関数とコールバック<a class="anchor-link" href="#%E9%96%A2%E6%95%B0%E3%81%A8%E3%82%B3%E3%83%BC%E3%83%AB%E3%83%90%E3%83%83%E3%82%AF">¶</a>
</h4>
<ul>
<li>
<code>std::function</code>でpythonの関数を受け取れる</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [38]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">pybind11</span>

#include &lt;pybind11/functional.h&gt;

PYBIND11_MODULE(callback_test, m) {
    m.def("for_even",
          [](int n, std::function&lt;void(int)&gt; f) {
              for (int i = 0; i &lt; n; ++i){ if (i % 2 == 0) f(i); }
          }
         );
}
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [39]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">py_callback_func</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"called </span><span class="si">{0}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    
<span class="n">for_even</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">py_callback_func</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>called 0
called 2
called 4
called 6
called 8
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="numpy対応">numpy対応<a class="anchor-link" href="#numpy%E5%AF%BE%E5%BF%9C">¶</a>
</h4>
<ul>
<li><code>#include &lt;pybind11/numpy.h&gt;</code></li>
<li>
<code>py::array_t&lt;type&gt;</code>型<ul>
<li>ndarrayを受け取ることが可能</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>
<code>arr.ndim</code>, <code>arr.shape(n)</code>, <code>arr.size()</code>
</li>
<li>バッファへのポインタ<ul>
<li>
<code>arr.data()</code>, <code>arr.mutable_data()</code>
</li>
<li>インデックス指定も可能</li>
</ul>
</li>
<li>要素への直接アクセス<ul>
<li>
<code>arr.unchecked()</code>, <code>arr.mutable_unchecked()</code>
</li>
<li>
<code>ref(i, j, k)</code>としてアクセス可能</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [31]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">pybind11</span>

#include &lt;pybind11/numpy.h&gt;

namespace py = pybind11;

PYBIND11_MODULE(numpy_bind, m) {
    m.def("add_2d",
          [](py::array_t&lt;double&gt; x, py::array_t&lt;double&gt; y){
              auto r = x.mutable_unchecked&lt;2&gt;();
              auto c = y.unchecked&lt;2&gt;();

            for(ssize_t i = 0; i &lt; r.shape(0); i++){
                for(ssize_t j = 0; j &lt; r.shape(1); j++){
                    r(i, j) += c(i, j);
                }
            }
          },  py::arg().noconvert(), py::arg().noconvert());
}
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [33]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [34]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">]])</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">]])</span>
<span class="n">add_2d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">x</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[34]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>array([[3., 5.],
       [7., 9.]])</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="まとめ">まとめ<a class="anchor-link" href="#%E3%81%BE%E3%81%A8%E3%82%81">¶</a>
</h4>
<ul>
<li>Python向けのC拡張モジュールをC++11で作成するためのライブラリpybind11について紹介</li>
<li>ipybindを用いたJupyter Notebookからの実行方法の紹介</li>
<li>numpy連携を紹介</li>
</ul>
</div>
</div>
</div>
</div>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/numpy/" rel="tag">numpy</a></li>
            <li><a class="tag p-category" href="../../categories/pybind11/" rel="tag">pybind11</a></li>
            <li><a class="tag p-category" href="../../categories/pydata/" rel="tag">pydata</a></li>
            <li><a class="tag p-category" href="../../categories/python/" rel="tag">python</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../13/" rel="prev" title="Pyroomacousticsの紹介">Previous post</a>
            </li>
            <li class="next">
                <a href="../15/" rel="next" title="2019/3/24にmatplotlibのアニメーション機能に関する発表を行いました">Next post</a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><h2>Comments</h2>
        
        
        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="hiromasa-info",
            disqus_url="http://www.hiromasa.info/en/posts/14/",
        disqus_title="2018/12/21\u306bPyData Osaka\u306e\u6885\u30ad\u30e3\u30f3Python\u52c9\u5f37\u4f1a\u30b3\u30e9\u30dc\u56de\u3067pybind11\u306b\u3064\u3044\u3066\u767a\u8868\u3057\u307e\u3057\u305f",
        disqus_identifier="cache/posts/14.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        </section><script src="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.js" integrity="sha384-9Nhn55MVVN0/4OFx7EE5kpFBPsEMZxKTCnA+4fqDmg12eCTqGi6+BB2LjY8brQxJ" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"></script><script>
                renderMathInElement(document.body,
                    {
                        
delimiters: [
    {left: "$$", right: "$$", display: true},
    {left: "\\[", right: "\\]", display: true},
    {left: "\\begin{equation*}", right: "\\end{equation*}", display: true},
    {left: "$", right: "$", display: false},
    {left: "\\(", right: "\\)", display: false}
]

                    }
                );
            </script></article><script>var disqus_shortname="hiromasa-info";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script><!--End of body content--><footer id="footer">
            Contents © 2020         <a href="mailto:stoicheia1986@gmail.com">Hiromasa OHASHI</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
<!-- twitter -->
<a href="https://twitter.com/share?ref_src=twsrc%5Etfw" class="twitter-share-button" data-show-count="false">Tweet</a>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script><!-- facebook --><div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = 'https://connect.facebook.net/ja_JP/sdk.js#xfbml=1&version=v2.11';
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script><div class="fb-like" data-layout="button" data-action="like" data-size="small" data-show-faces="true" data-share="true"></div>

<!-- hatena -->
<a href="http://b.hatena.ne.jp/entry/" class="hatena-bookmark-button" data-hatena-bookmark-layout="basic-counter" title="このエントリーをはてなブックマークに追加">
<img src="https://b.st-hatena.com/images/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;"></a>
<script type="text/javascript" src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script></footer>
</div>
</div>


        <script src="../../../assets/js/all-nocdn.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script>
</body>
</html>
