<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>hiromasa.info</title>
<style>
        @font-face {
            font-family: "libretto-icons";
            src:url(assets/fonts/libretto-icons.eot);
            src:url(assets/fonts/libretto-icons.eot#iefix) format("embedded-opentype"),
            url(assets/fonts/libretto-icons.woff) format("woff"),
            url(assets/fonts/libretto-icons.ttf) format("truetype"),
            url(assets/fonts/libretto-icons.svg#libretto-icons) format("svg");
            font-weight: normal;
            font-style: normal;
        }
    </style>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Droid+Sans+Mono%7CLibre+Baskerville%7CMontserrat%7CPlayfair+Display">
<link rel="stylesheet" href="assets/css/libretto_styles.css">
</head>
<body>
    <!-- Navigation bar -->
    <header class="nav-bar"><div class="site-branding">
            <h1 class="site-title">
                <a href="http://www.hiromasa.info/" title="hiromasa.info" rel="home">hiromasa.info</a>
            </h1>
        </div>
        <nav class="site-navigation" role="navigation"><div class="menu-toggle">
                <span class="mobile-site-title">hiromasa.info</span>
            </div>
            <ul class="menu">
<li><a href="archive.html">文書一覧</a></li>
                    <li><a href="categories/">タグ</a></li>
                    <li><a href="pages/about/index.html">About</a></li>
                    <li><a href="rss.xml">RSSフィード</a></li>
            </ul></nav></header><div class="site-content">
            <article class="format-standard libretto-long-form"><div class="title-block post-format-icon-pin">
                    <div class="entry-meta">
                        <span class="posted-on">
                            Posted on <a href="posts/1/" rel="bookmark">1月 7, 2018</a>
                        </span>
                    </div>
                    <h1><a href="posts/1/">Nikolaでブログ構築してGithub Pagesに設置</a></h1>
                </div>
                <div class="entry-content">
                        <div>
<h3>Nikolaとは</h3>
<p>Python製のstatic site generator。python製だとpelicanの方が有名だがipynbが使えると聞いたのでこちらを使うことにした。</p>
<h3>Nikolaでブログを生成</h3>
<h4>インストール</h4>
<p>pipでインストールできる。</p>
<pre class="code literal-block"><span></span>$ pip install nikola
$ pip install webassets
</pre>


<p>後述するbuildの際などに下記のようなメッセージが出るので合わせてwebassetsもインストールしておくと良い。</p>
<pre class="code literal-block"><span></span>[2018-01-08T01:42:01Z] WARNING: Nikola: In order to USE_BUNDLES, you must install the "webassets" Python package.
[2018-01-08T01:42:01Z] WARNING: bundles: Setting USE_BUNDLES to False.
</pre>


<h4>ブログの雛形生成</h4>
<p>nikolaはgitのように<code>nikola サブコマンド</code>の形式で様々なコマンドを実行できる。
雛形の生成のためには<code>nikola init</code>を実行する。</p>
<pre class="code literal-block"><span></span>nikola init blog_name
</pre>


<p>これを実行するとCUIベースで対話的に様々な設定が可能。
commentシステムとして何を使うかを聞かれるが、後でconf.pyを書き換えれば設定が可能な模様であるため一旦は空白で良い。</p>
<p>なお<a href="https://getnikola.com/getting-started.html">Getting Started</a>ではinitの際に引数に<code>--demo</code>を付けているが、
この引数を付けるとデモ用コンテンツが生成されてしまうので普通に真っさらな状態で始めたいならば付けない方が良い。</p>
<h4>新記事生成</h4>
<p>新記事生成は下記の通り。</p>
<pre class="code literal-block"><span></span>$ nikola new_post -f markdown  <span class="c1"># formatを-fで指定(デフォルトはReStructuredText形式)</span>
</pre>


<p>実行すると記事タイトルを聞かれるので打ち込むと<code>-f</code>で指定した形式のファイルがposts以下に生成される。
また、引数に<code>-e</code>を付けるとそのままエディタでの編集画面となる。</p>
<p>生成されたファイルの冒頭には下記のような形のヘッダーが付いている。</p>
<pre class="code literal-block"><span></span>&lt;!--
.. title: Nikolaでブログ構築してGithub Pagesに設置
.. slug: 1
.. date: 2018-01-07 23:35:28 UTC+09:00
.. tags: nikola, python, github
.. category: 
.. link: 
.. description: 
.. type: text
--&gt;
</pre>


<p>titleは記事タイトルである。
slugはurlの一部となる文字列である。記事タイトルをアルファベットに直したものが記載されているが、適当に修正すると良い。1にしておくと<code>http://www.hiromasa.info/1/</code>のようなURLとなる。</p>
<h4>固定ページ生成</h4>
<p>固定ページはpostではなくpageとして生成する。</p>
<pre class="code literal-block"><span></span>$ nikola new_page -f markdown pages/about
</pre>


<p>生成した固定ページを上部ナビゲーションに配置する方法は下記のように<code>conf.py</code>の<code>NAVIGATION_LINKS</code>に書けば良い。</p>
<pre class="code literal-block"><span></span><span class="n">NAVIGATION_LINKS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">DEFAULT_LANG</span><span class="p">:</span> <span class="p">(</span>
        <span class="p">(</span><span class="s2">"/archive.html"</span><span class="p">,</span> <span class="s2">"文書一覧"</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">"/categories/"</span><span class="p">,</span> <span class="s2">"タグ"</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">"/pages/about/index.html"</span><span class="p">,</span> <span class="s2">"About"</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">"/rss.xml"</span><span class="p">,</span> <span class="s2">"RSSフィード"</span><span class="p">),</span>
    <span class="p">),</span>
<span class="p">}</span>
</pre>


<h4>ブログ構築</h4>
<p>postやpageを上記のように生成しただけでは単なるテキストが生成されているだけなので、これらを元にブログを構築する。</p>
<pre class="code literal-block"><span></span>$ nikola build
</pre>


<p>これでブログが構築される。
ローカルで確認するためには下記を実行する。</p>
<pre class="code literal-block"><span></span>$ nikola serve -b  <span class="c1"># --browserでも良い</span>
</pre>


<h4>ブログテーマ設定</h4>
<p>デフォルトはbootstrap3になるようであるが、他のものに変えたい場合は<a href="https://themes.getnikola.com/">themes</a>のページから好きなものを選ぶ。
ここでは<a href="https://themes.getnikola.com/v7/libretto/">libretto</a>のテーマを選んだ。
wordpressの同名テーマをベースにしたものらしい。</p>
<p>テーマのインストールは下記の通り。</p>
<pre class="code literal-block"><span></span>$ nikola thme -i libretto
</pre>


<p>実行するとthemesディレクトリ以下にlibrettoのテーマがダウンロードされる。</p>
<p>このテーマを使用するためには更にconf.pyを編集する必要がある。</p>
<pre class="code literal-block"><span></span><span class="c1"># Name of the theme to use.</span>
<span class="c1"># THEME = "bootstrap3"</span>
<span class="n">THEME</span> <span class="o">=</span> <span class="s2">"libretto"</span>
</pre>


<p>この上で<code>nikola build</code>を実行すれば更新後のテーマに変わっている。
記事の一文字目だけ大きく表示されるのが若干気に入らないがとりあえずこれで行く。</p>
<h3>Github Pagesに配置</h3>
<p><a href="https://getnikola.com/handbook.html#deployment">HandbookのDeployment</a>の項を見るとGithubでホスティングする方法が記載されている。ここではGitHubのuser page(wrist.github.io)に配置することを考える。</p>
<h4>1. gitリポジトリの設定を行う</h4>
<p>過去にwrist.github.ioリポジトリを作成しているため、ブログのルートで<code>git init</code>してからremoteを設定する。</p>
<pre class="code literal-block"><span></span>$ git init
$ git remote add origin git@github.com:wrist/wrist.github.io
</pre>


<h4>2. (必要であれば)conf.pyを編集する</h4>
<p>必要であれば下記を編集する。今回は不要であるため特に変更していない。</p>
<pre class="code literal-block"><span></span><span class="c1"># siteのソースがdeployされるブランチ名、srcが推奨とのこと</span>
<span class="n">GITHUB_SOURCE_BRANCH</span> <span class="o">=</span> <span class="s1">'src'</span>
<span class="c1"># HTMLファイルがdeployされるブランチ、user pageの場合はmaster</span>
<span class="n">GITHUB_DEPLOY_BRANCH</span> <span class="o">=</span> <span class="s1">'master'</span>
<span class="c1"># gitのremote名</span>
<span class="n">GITHUB_REMOTE_NAME</span> <span class="o">=</span> <span class="s1">'origin'</span>
<span class="c1"># ソースブランチを自動的にコミットしプッシュするかの設定</span>
<span class="n">GITHUB_COMMIT_SOURCE</span> <span class="o">=</span> <span class="bp">True</span>
</pre>


<h4>3. .gitignoreを追加</h4>
<p>下記内容を.gitignoreに追加する。</p>
<pre class="code literal-block"><span></span>cache
.doit.db
__pycache__
output
</pre>


<h4>4. deploy用のコマンドを実行</h4>
<p>下記コマンドを実行することでdeployが可能。</p>
<pre class="code literal-block"><span></span>$ nikola github_deploy
</pre>


<p>下記のように表示された場合は<code>pip install ghp-import2</code>でghp-import2をインストールする。</p>
<pre class="code literal-block"><span></span>[2018-01-08T04:16:04Z] ERROR: Nikola: In order to deploy the site to GitHub Pages, you must install the "ghp-import2" Python package.
[2018-01-08T04:16:04Z] ERROR: Nikola: Exiting due to missing dependencies.
</pre>


<p>通常はこれで改めて<code>nikola github_deploy</code>を実行すれば終わりのはずである。
しかし、今回は過去に作成済の既にmasterが存在しているリポジトリにpushしようとしているため、当然先にfetchしろと警告が出て失敗する。</p>
<pre class="code literal-block"><span></span><span class="o">[</span><span class="m">2018</span>-01-08T04:17:10Z<span class="o">]</span> INFO: github_deploy: <span class="o">==</span>&gt; <span class="o">[</span><span class="s1">'ghp-import'</span>, <span class="s1">'-n'</span>, <span class="s1">'-m'</span>, <span class="s1">'Nikola auto commit.\n\nSource commit: a37690e35a31dc4a108f53c62b8ee17e783aa28f\nNikola version: 7.8.11'</span>, <span class="s1">'-p'</span>, <span class="s1">'-r'</span>, <span class="s1">'origin'</span>, <span class="s1">'-b'</span>, <span class="s1">'master'</span>, <span class="s1">'output'</span><span class="o">]</span>
To github.com:wrist/wrist.github.io
 ! <span class="o">[</span>rejected<span class="o">]</span>        master -&gt; master <span class="o">(</span>fetch first<span class="o">)</span>
error: failed to push some refs to <span class="s1">'git@github.com:wrist/wrist.github.io'</span>
hint: Updates were rejected because the remote contains work that you <span class="k">do</span>
hint: not have locally. This is usually caused by another repository pushing
hint: to the same ref. You may want to first integrate the remote changes
hint: <span class="o">(</span>e.g., <span class="s1">'git pull ...'</span><span class="o">)</span> before pushing again.
hint: See the <span class="s1">'Note about fast-forwards'</span> in <span class="s1">'git push --help'</span> <span class="k">for</span> details.
</pre>


<p>仕方ないので<a href="https://rcmdnk.com/blog/2013/11/01/computer-git/">この記事</a>に倣い、先にmasterを強制pushする。</p>
<pre class="code literal-block"><span></span>$ git push -f origin master
$ nikola github_deploy
</pre>


<h3>その他</h3>
<p>記事のデフォルト形式をmarkdownに変えたいが方法が分からないため<a href="https://getnikola.com/handbook.html">Handbook</a>を読んでもう少し調べる必要があるが、
ReStructuredTextで書くとExtensionとして<a href="https://getnikola.com/handbook.html#restructuredtext-extensions">いくつかのdirectiveやroleが使える</a>ようでもあるため、もう少し使ってみてから考えたい。</p>
<h3>参考</h3>
<ul>
<li><a href="https://getnikola.com/handbook.html">Handbook</a></li>
<li><a href="https://qiita.com/driller/items/4d998ca765717c7e0a6c">drillerさんによる基本的な使い方の記事</a></li>
<li><a href="https://qiita.com/driller/items/2f8a0dd66d4d8e59e05c">ipynb形式を扱う方法</a></li>
</ul>
<!-- Google Analytics: change UA-XXXXX-X to be your site's ID. --><script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-48887105-1', 'hiromasa.info');
    ga('send', 'pageview');
</script>
</div>
                </div>
            </article>
</div>
    <!-- Lower Navigation links -->
    <nav class="site-content navigation-post" role="navigation"><div class="previous">
                <a href="." rel="prev" onclick="return false;">
                    <span class="meta-nav">No More Older Entries</span>                </a>
            </div>
    </nav><!-- Page Footer --><section class="footer-sidebar clear" role="complementary"><div class="widget-block">
            <aside class="widget"><h2 class="widget-title">hiromasa.info</h2>
                <div class="widget-text">blog by Hiromasa OHASHI</div>
            </aside>
</div>
    </section><!-- Site Attributions --><footer class="site-footer" role="contentinfo"><div class="site-info">
            <p>Contents © 2018         <a href="mailto:stoicheia1986@gmail.com">Hiromasa OHASHI</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         </p>
            <p>Powered by <a href="https://getnikola.com/">Nikola</a> using the <a href="https://note2self.abraham-v.com/libretto-theme-for-nikola/">Libretto theme</a>.</p>
        </div>
        <div class="social">
            <ul class="menu"></ul>
</div>
    </footer>
</body>
</html>
